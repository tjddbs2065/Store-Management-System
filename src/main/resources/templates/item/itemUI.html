<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>재고 품목 조회</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        /* ===== 공통 토큰 (스토어/히스토리 페이지와 통일) ===== */
        .erp-item-list{ --ctl-h:31px; --ctl-font:.95rem; --brand:#FFEEAA; --brand-hover:#f2da84; }
        .erp-item-list body{ background:#f8f9fa; }
        .erp-item-list .layout-container{ max-width:1500px; margin:0 auto; }

        /* 컨트롤 통일 */
        .erp-item-list :where(.ctl .form-control, .ctl .form-select, .ctl .btn){ height:var(--ctl-h); font-size:var(--ctl-font); }
        .erp-item-list .w-compact{ max-width:220px; }
        .erp-item-list .w-compact-lg{ max-width:320px; }

        /* 버튼 */
        .erp-item-list .btn-main{ background:var(--brand); border-color:var(--brand); color:#000; }
        .erp-item-list .btn-main:hover{ background:var(--brand-hover); border-color:var(--brand-hover); color:#000; }

        /* 테이블 */
        .erp-item-list table.item-table thead{ background:#e9ecef !important; }
        .erp-item-list table.item-table th{ color:#212529 !important; }
        .erp-item-list table.item-table td, .erp-item-list table.item-table th{ font-size:.9rem; vertical-align:middle; }
        .erp-item-list .text-code{ font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace; }
        .erp-item-list .text-price{ text-align:right; white-space:nowrap; }

        /* 아이콘 버튼 */
        .erp-item-list .icon-btn{ border:0; background:transparent; padding:4px; line-height:1; }
        .erp-item-list .icon-btn:focus{ box-shadow:none; }

        .erp-item-list .pagination{ margin-top:16px; margin-bottom:0; }
    </style>
</head>
<body class="erp-item-list">

<header th:replace="fragments/toolBar :: toolBarManager"></header>

<main class="py-4">
    <div class="layout-container">

        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="fw-bold mb-0">재고 품목 조회</h3>
            <button class="btn btn-main" th:onclick="|location.href='@{/item/add}'|">
                새 품목 등록
            </button>
        </div>

        <!-- 검색: 한 줄 구성 -->
        <div class="card p-3 mb-3 shadow-sm border-0">
            <div class="row g-2 align-items-end ctl">
                <div class="col-6 col-md-2">
                    <label class="fw-bold small d-block mb-1">카테고리</label>
                    <select id="categorySelect" class="form-select form-select-sm">
                        <option value="">전체</option><option>도우</option><option>소스</option>
                        <option>치즈</option><option>토핑</option><option>야채</option>
                        <option>사이드</option><option>기타</option>
                    </select>
                </div>

                <div class="col-6 col-md-2">
                    <label class="fw-bold small d-block mb-1">검색 조건</label>
                    <select id="searchTypeSelect" class="form-select form-select-sm">
                        <option value="ITEM_NAME">품목명</option>
                        <option value="ITEM_CODE">품목코드</option>
                        <option value="INGREDIENT">재료명</option>
                        <option value="SUPPLIER">공급사</option>
                    </select>
                </div>

                <div class="col-12 col-md-4">
                    <label class="fw-bold small d-block mb-1">검색어</label>
                    <div class="input-group input-group-sm">
                        <input id="searchKeyword" class="form-control" placeholder="검색어 입력">
                        <button class="btn btn-main" id="btnSearch">검색</button>
                        <button class="btn btn-outline-secondary" id="btnReset">초기화</button>
                    </div>
                </div>

                <div class="col d-none d-md-block"></div>
            </div>
        </div>

        <!-- 목록 -->
        <div class="card shadow-sm border-0">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0 item-table bg-white">
                        <thead>
                        <tr class="table-light">
                            <th style="width:10%">카테고리</th>
                            <th style="width:18%">품목코드</th>
                            <th style="width:24%">품목명</th>
                            <th style="width:20%">재료명</th>
                            <th style="width:16%">공급사</th>
                            <th style="width:8%" class="text-end">공급가격</th>
                            <th style="width:4%" class="text-center">상세</th>
                        </tr>
                        </thead>
                        <tbody id="itemTableBody">
                        <!-- ===== 샘플 데이터 (서버바인딩으로 교체 가능) ===== -->
                        <tr data-category="도우" data-code="DOUGH-M-230G" data-name="도우 230g" data-ingredient="피자 도우M" data-supplier="신선신선 도우" data-price="22000">
                            <td>도우</td><td class="text-code">DOUGH-M-230G</td><td>도우 230g</td><td>피자 도우M</td><td>신선신선 도우</td><td class="text-price">22,000</td>
                            <td class="text-center"><button class="icon-btn detail-btn" title="상세보기" th:onclick="|location.href='@{/item/detail}'|"><i class="bi bi-file-earmark-text"></i></button></td>
                        </tr>
                        <tr data-category="도우" data-code="DOUGH-L-300G" data-name="도우 300g" data-ingredient="피자 도우L" data-supplier="신선신선 도우" data-price="24000">
                            <td>도우</td><td class="text-code">DOUGH-L-300G</td><td>도우 300g</td><td>피자 도우L</td><td>신선신선 도우</td><td class="text-price">24,000</td>
                            <td class="text-center"><button class="icon-btn detail-btn" title="상세보기" th:onclick="|location.href='@{/item/detail}'|"><i class="bi bi-file-earmark-text"></i></button></td>
                        </tr>
                        <tr data-category="소스" data-code="SAUCE-3KG-CAN" data-name="토마토 소스 3kg 캔" data-ingredient="토마토 페이스트" data-supplier="프레시소스" data-price="17500">
                            <td>소스</td><td class="text-code">SAUCE-3KG-CAN</td><td>토마토 소스 3kg 캔</td><td>토마토 페이스트</td><td>프레시소스</td><td class="text-price">17,500</td>
                            <td class="text-center"><button class="icon-btn detail-btn" title="상세보기" th:onclick="|location.href='@{/item/detail}'|"><i class="bi bi-file-earmark-text"></i></button></td>
                        </tr>
                        <!-- 필요 시 더 추가 -->
                        </tbody>
                    </table>
                </div>

                <!-- 페이지네이션 -->
                <nav class="mt-2 mb-2">
                    <ul class="pagination justify-content-center pagination-sm" id="pager"></ul>
                </nav>
            </div>
        </div>

    </div>
</main>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    /* ===== 클라이언트 페이징 + 필터 ===== */
    const ROWS_PER_PAGE = 10;
    let $allRows = $(), $filtered = $(), totalPages = 1, currentPage = 1;

    function snapshotRows(){ $allRows = $('#itemTableBody tr'); }
    function applyFilter(){
        const cat  = $('#categorySelect').val();
        const type = $('#searchTypeSelect').val();
        const kw   = ($('#searchKeyword').val()||'').trim();

        $filtered = $allRows.filter(function(){
            const $tr = $(this);
            if(cat && ($tr.data('category')||'') !== cat) return false;
            if(!kw) return true;

            if(type === 'ITEM_NAME')   return String($tr.data('name')||'').indexOf(kw) !== -1;
            if(type === 'ITEM_CODE')   return String($tr.data('code')||'').indexOf(kw) !== -1;
            if(type === 'INGREDIENT')  return String($tr.data('ingredient')||'').indexOf(kw) !== -1;
            if(type === 'SUPPLIER')    return String($tr.data('supplier')||'').indexOf(kw) !== -1;
            return true;
        });
    }
    function buildPager(){
        const total = $filtered.length;
        totalPages = Math.max(1, Math.ceil(total / ROWS_PER_PAGE));
        const $p = $('#pager').empty();
        const li = (d,t)=>$(`<li class="page-item"><a class="page-link" href="#" data-page="${d}">${t}</a></li>`);
        $p.append(li('first','«')).append(li('prev','‹'));
        for(let i=1;i<=totalPages;i++) $p.append(li(String(i), String(i)));
        $p.append(li('next','›')).append(li('last','»'));
    }
    function showPage(n){
        currentPage = n;
        $allRows.hide();
        const s = (n-1)*ROWS_PER_PAGE, e = s + ROWS_PER_PAGE;
        $filtered.slice(s,e).show();
        paintPager();
    }
    function paintPager(){
        const $p = $('#pager');
        $p.find('.page-item').removeClass('active disabled');
        $p.find(`a[data-page="${currentPage}"]`).parent().addClass('active');
        if(currentPage===1){ dis('first'); dis('prev'); }
        if(currentPage===totalPages){ dis('last'); dis('next'); }
        function dis(k){ $p.find(`a[data-page="${k}"]`).parent().addClass('disabled'); }
    }
    $(document).on('click', '#pager a.page-link', function(e){
        e.preventDefault();
        const act=$(this).data('page'); const $li=$(this).parent();
        if($li.hasClass('disabled')||$li.hasClass('active')) return;
        if(act==='first') showPage(1);
        else if(act==='prev') showPage(Math.max(1,currentPage-1));
        else if(act==='next') showPage(Math.min(totalPages,currentPage+1));
        else if(act==='last') showPage(totalPages);
        else { const n=parseInt(act,10); if(!isNaN(n)) showPage(n); }
    });

    function refresh(){
        snapshotRows();
        applyFilter();
        buildPager();
        showPage(1);
    }

    /* ===== 이벤트 ===== */
    $(function(){
        refresh();
        $('#btnSearch').on('click', refresh);
        $('#btnReset').on('click', function(){
            $('#categorySelect').val('');
            $('#searchTypeSelect').val('ITEM_NAME');
            $('#searchKeyword').val('');
            refresh();
        });
    });
</script>
</body>
</html>
